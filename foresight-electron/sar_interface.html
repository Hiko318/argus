<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foresight 1.0 - SAR Interface</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Custom Styles -->
    <style>
        /* Basic reset and layout */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
        }
        
        .sar-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* Header styles */
        .header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 10px 20px;
            border-bottom: 2px solid #3498db;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            position: relative;
            width: 30px;
            height: 30px;
        }
        
        .logo-outer-circle {
            width: 30px;
            height: 30px;
            border: 2px solid #3498db;
            border-radius: 50%;
            position: absolute;
        }
        
        .logo-inner-circle {
            width: 16px;
            height: 16px;
            background: #3498db;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: bold;
            color: #ffffff;
        }
        
        .logo-license {
            font-size: 12px;
            color: #95a5a6;
            font-style: italic;
        }
        
        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .header-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .header-btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-1px);
        }
        
        .header-dropdown {
            background: #34495e;
            color: white;
            border: 1px solid #3498db;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .close-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Main content area */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .video-section {
            flex: 2;
            background: #000;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #video-feed {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .sidebar {
            flex: 1;
            background: #2c3e50;
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }
        
        .sidebar-section {
            padding: 15px;
            border-bottom: 1px solid #34495e;
        }
        
        .sidebar-section h3 {
            color: #3498db;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .telemetry-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .telemetry-item {
            background: #34495e;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        
        .telemetry-label {
            font-size: 12px;
            color: #95a5a6;
            display: block;
        }
        
        .telemetry-value {
            font-size: 14px;
            font-weight: bold;
            color: #ffffff;
        }
        
        #map {
            height: 200px;
            border-radius: 5px;
        }
        
        .target-upload {
            border: 2px dashed #3498db;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .target-upload:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .target-preview {
            max-width: 100%;
            max-height: 150px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .detection-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .detection-item {
            background: #34495e;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #3498db;
        }
        
        .detection-confidence {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-connected {
            background: #2ecc71;
        }
        
        .status-disconnected {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="sar-container">
        <!-- Header Bar -->
        <div class="header-bar">
            <div class="logo">
                <div class="logo-icon">
                    <div class="logo-outer-circle"></div>
                    <div class="logo-inner-circle"></div>
                </div>
                <span class="logo-text">Foresight 1.0</span>
                <span class="logo-license">licensed</span>
            </div>
            <div class="header-controls">
                <button class="header-btn" onclick="toggleConnection()">Connect</button>
                <button class="header-btn" onclick="startSystem()">Start</button>
                <button class="header-btn" onclick="stopSystem()">Stop</button>
                <select class="header-dropdown" id="mode-dropdown" onchange="changeMode(this.value)">
                    <option value="regular">Regular</option>
                    <option value="sar">SAR (Search And Rescue)</option>
                    <option value="suspect-lock">SL (Suspect-Lock)</option>
                </select>
                <button class="header-btn" onclick="exportMissionData()">Export</button>
                <button class="header-btn" onclick="openSettings()">Settings</button>
            </div>
            <button class="close-btn" onclick="closeApplication()">&times;</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Video Section -->
            <div class="video-section">
                <div class="video-container">
                    <video id="video-feed" autoplay muted>
                        <source src="" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="video-overlay" id="video-overlay">
                        <!-- Detection overlays will be added here -->
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Telemetry Section -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-satellite-dish"></i> Telemetry</h3>
                    <div class="telemetry-grid">
                        <div class="telemetry-item">
                            <span class="telemetry-label">Altitude</span>
                            <span class="telemetry-value" id="altitude">0 m</span>
                        </div>
                        <div class="telemetry-item">
                            <span class="telemetry-label">Speed</span>
                            <span class="telemetry-value" id="speed">0 m/s</span>
                        </div>
                        <div class="telemetry-item">
                            <span class="telemetry-label">Battery</span>
                            <span class="telemetry-value" id="battery">100%</span>
                        </div>
                        <div class="telemetry-item">
                            <span class="telemetry-label">Signal</span>
                            <span class="telemetry-value" id="signal">Strong</span>
                        </div>
                    </div>
                </div>

                <!-- Map Section -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-map"></i> Map</h3>
                    <div id="map"></div>
                </div>

                <!-- Target Section -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-crosshairs"></i> Target</h3>
                    <div class="target-upload" onclick="document.getElementById('target-input').click()">
                        <i class="fas fa-upload"></i>
                        <p>Upload Target Image</p>
                        <input type="file" id="target-input" accept="image/*" style="display: none;" onchange="handleTargetUpload(event)">
                        <img id="target-preview" class="target-preview" style="display: none;">
                    </div>
                </div>

                <!-- Detections Section -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-eye"></i> Detections</h3>
                    <div class="detection-list" id="detection-list">
                        <!-- Detection items will be added here -->
                    </div>
                </div>

                <!-- Status Section -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-info-circle"></i> Status</h3>
                    <div>
                        <span class="status-indicator status-disconnected" id="connection-status"></span>
                        <span id="connection-text">Disconnected</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Custom Scripts -->
    <script>
        // Global variables
        let map;
        let sarInterface;
        let isConnected = false;
        let currentMode = 'regular';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            initializeSARInterface();
            updateConnectionStatus();
        });
        
        // Initialize Leaflet map
        function initializeMap() {
            map = L.map('map').setView([37.7749, -122.4194], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
        }
        
        // Initialize SAR Interface
        function initializeSARInterface() {
            // This would connect to the backend SAR service
            console.log('Initializing SAR Interface...');
        }
        
        // Header button functions
        function toggleConnection() {
            isConnected = !isConnected;
            updateConnectionStatus();
            console.log('Connection toggled:', isConnected);
        }
        
        function startSystem() {
            console.log('System started');
        }
        
        function stopSystem() {
            console.log('System stopped');
        }
        
        function changeMode(mode) {
            currentMode = mode;
            console.log('Mode changed to:', mode);
        }
        
        function exportMissionData() {
            console.log('Exporting mission data...');
        }
        
        function openSettings() {
            console.log('Opening settings...');
        }
        
        function closeApplication() {
            if (window.electronAPI) {
                window.electronAPI.closeApp();
            } else {
                window.close();
            }
        }
        
        // Update connection status
        function updateConnectionStatus() {
            const statusIndicator = document.getElementById('connection-status');
            const statusText = document.getElementById('connection-text');
            
            if (isConnected) {
                statusIndicator.className = 'status-indicator status-connected';
                statusText.textContent = 'Connected';
            } else {
                statusIndicator.className = 'status-indicator status-disconnected';
                statusText.textContent = 'Disconnected';
            }
        }
        
        // Handle target image upload
        function handleTargetUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('target-preview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Add detection to the list
        function addDetection(detection) {
            const detectionList = document.getElementById('detection-list');
            const detectionItem = document.createElement('div');
            detectionItem.className = 'detection-item';
            detectionItem.innerHTML = `
                <div>Person detected</div>
                <div class="detection-confidence">${(detection.confidence * 100).toFixed(1)}%</div>
                <div style="font-size: 12px; color: #95a5a6;">${new Date().toLocaleTimeString()}</div>
            `;
            detectionList.insertBefore(detectionItem, detectionList.firstChild);
            
            // Keep only the last 10 detections
            while (detectionList.children.length > 10) {
                detectionList.removeChild(detectionList.lastChild);
            }
        }
        
        // Update telemetry data
        function updateTelemetry(data) {
            if (data.altitude !== undefined) {
                document.getElementById('altitude').textContent = data.altitude + ' m';
            }
            if (data.speed !== undefined) {
                document.getElementById('speed').textContent = data.speed + ' m/s';
            }
            if (data.battery !== undefined) {
                document.getElementById('battery').textContent = data.battery + '%';
            }
            if (data.signal !== undefined) {
                document.getElementById('signal').textContent = data.signal;
            }
        }
    </script>
</body>
</html>